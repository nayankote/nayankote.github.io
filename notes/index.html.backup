<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Notes - Nayan Kote</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Obsidian-inspired minimal fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        /* ============================================
           COLOR SCHEME - Obsidian-inspired
           ============================================ */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --text-primary: #2e3338;
            --text-secondary: #6c757d;
            --text-muted: #9aa0a6;
            --border: #e5e5e5;
            --accent: #7c3aed;
            --accent-hover: #6d28d9;
            --node-personal: #ef4444;
            --node-work: #3b82f6;
            --node-fitness: #10b981;
            --node-ironman: #f59e0b;
            --node-thinking: #8b5cf6;
            --node-til: #06b6d4;
            --node-startups: #ec4899;
            --node-ideas: #14b8a6;
            --node-mental-health: #a855f7;
            --node-career: #6366f1;
            --node-default: #64748b;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1e1e1e;
                --bg-secondary: #252525;
                --text-primary: #dcddde;
                --text-secondary: #b9bbbe;
                --text-muted: #72767d;
                --border: #3a3a3a;
                --accent: #a78bfa;
                --accent-hover: #8b5cf6;
            }
        }

        html.theme-dark {
            --bg-primary: #1e1e1e;
            --bg-secondary: #252525;
            --text-primary: #dcddde;
            --text-secondary: #b9bbbe;
            --text-muted: #72767d;
            --border: #3a3a3a;
            --accent: #a78bfa;
            --accent-hover: #8b5cf6;
        }

        html.theme-light {
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --text-primary: #2e3338;
            --text-secondary: #6c757d;
            --text-muted: #9aa0a6;
            --border: #e5e5e5;
            --accent: #7c3aed;
            --accent-hover: #6d28d9;
        }

        /* ============================================
           BASE STYLES - Clean & Minimal
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 15px;
            line-height: 1.6;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ============================================
           NAVIGATION - Obsidian style
           ============================================ */
        .nav-header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            position: relative;
            z-index: 100;
        }

        .nav-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-wrapper ul {
            display: flex;
            gap: 8px;
            list-style: none;
        }

        .nav-wrapper ul li a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            letter-spacing: -0.01em;
        }

        .nav-wrapper ul li a:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .nav-wrapper ul li.active a {
            color: var(--accent);
            background: var(--bg-secondary);
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .control-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .control-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--accent);
        }

        .filter-group {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .filter-tag {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            text-transform: lowercase;
        }

        .filter-tag:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .filter-tag.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* ============================================
           GRAPH CONTAINER - Full viewport
           ============================================ */
        #graph-container {
            width: 100vw;
            height: calc(100vh - 50px);
            position: relative;
            background: var(--bg-primary);
        }

        svg {
            width: 100%;
            height: 100%;
        }

        /* ============================================
           NODES & LINKS - Obsidian-inspired
           ============================================ */
        .node {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .node:hover circle {
            stroke-width: 3px;
            filter: brightness(1.1);
        }

        .node circle {
            stroke: var(--bg-primary);
            stroke-width: 2px;
            transition: all 0.2s ease;
        }

        .node text {
            font-size: 10px;
            font-weight: 500;
            fill: var(--text-muted);
            pointer-events: none;
            text-anchor: middle;
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.01em;
        }

        .link {
            stroke: var(--border);
            stroke-opacity: 0.4;
            stroke-width: 1px;
            transition: all 0.2s ease;
        }

        .link.strong {
            stroke-width: 2px;
            stroke-opacity: 0.6;
        }

        .link.highlighted {
            stroke: var(--accent);
            stroke-opacity: 0.8;
            stroke-width: 2px;
        }

        /* ============================================
           MODAL - Clean & Readable
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-content {
            background: var(--bg-primary);
            margin: 8vh auto;
            padding: 24px;
            border: 1px solid var(--border);
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.4;
            letter-spacing: -0.02em;
        }

        .close {
            color: var(--text-muted);
            font-size: 24px;
            font-weight: 300;
            cursor: pointer;
            transition: color 0.2s ease;
            line-height: 1;
            flex-shrink: 0;
        }

        .close:hover {
            color: var(--text-primary);
        }

        .modal-metadata {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .modal-date {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .modal-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: white;
            text-transform: lowercase;
        }

        .modal-text {
            line-height: 1.7;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ============================================
           SCROLLBAR - Custom styling
           ============================================ */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 768px) {
            .nav-wrapper {
                flex-direction: column;
                gap: 12px;
            }

            .controls {
                width: 100%;
                justify-content: space-between;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
                margin: 4vh auto;
            }
        }
    </style>

    <!-- Theme toggle script (matching your site) -->
    <script>
        function getPreferredTheme() {
            const stored = localStorage.getItem('theme');
            return stored || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        }

        function setTheme(theme) {
            document.documentElement.className = theme === 'dark' ? 'theme-dark' : 'theme-light';
            localStorage.setItem('theme', theme);
        }

        document.addEventListener('DOMContentLoaded', function () {
            setTheme(getPreferredTheme());
        });
    </script>
</head>

<body>
    <!-- Navigation -->
    <div class="nav-header">
        <nav class="nav-wrapper" aria-label="Main">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/blogs/">Blogs</a></li>
                <li class="active"><a href="/notes/">Notes</a></li>
                <li><a href="/projects/">Projects</a></li>
            </ul>
            <div class="controls">
                <button class="control-btn" onclick="resetZoom()">Reset View</button>
                <button class="control-btn" onclick="toggleFilters()">Filter Tags</button>
            </div>
        </nav>
    </div>

    <!-- Filter panel (initially hidden) -->
    <div id="filter-panel" style="display: none; padding: 12px 24px; border-bottom: 1px solid var(--border); background: var(--bg-secondary);">
        <div class="filter-group" id="filterTags"></div>
    </div>

    <!-- Graph Container -->
    <div id="graph-container">
        <svg id="graph"></svg>
    </div>

    <!-- Modal for note details -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-metadata">
                <div class="modal-date" id="modalDate"></div>
                <div class="modal-tags" id="modalTags"></div>
            </div>
            <div class="modal-text" id="modalText"></div>
        </div>
    </div>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        
        // Tag colors matching CSS variables
        const tagColors = {
            "personal": "#ef4444",
            "work": "#3b82f6",
            "fitness": "#10b981",
            "ironman": "#f59e0b",
            "thinking": "#8b5cf6",
            "til": "#06b6d4",
            "startups": "#ec4899",
            "ideas": "#14b8a6",
            "mental-health": "#a855f7",
            "career": "#6366f1"
        };

        // Minimum shared tags for connection (reduces line clutter)
        const MIN_CONNECTION_STRENGTH = 1; // Only show connections with 1+ shared tags
        const MAX_CONNECTIONS_PER_NODE = 5; // Maximum connections per node

        // ============================================
        // DATA - Will be loaded from notes.json
        // ============================================
        
        // Sample data (replace with fetch from notes.json)
        const notes = [
            { id: 1, title: "Morning Reflection", tags: ["personal"], date: "2025-11-28", text: "Started the day with meditation. Feeling grateful for the small moments of peace in a busy world." },
            { id: 2, title: "Product Idea", tags: ["work", "ideas", "startups"], date: "2025-11-27", text: "What if we built a tool that helps people visualize their thoughts? Like a mind map but more interactive." },
            { id: 3, title: "5K Run", tags: ["fitness"], date: "2025-11-26", text: "Completed my first 5K in under 30 minutes! Legs are sore but feeling accomplished." },
            { id: 4, title: "Career Growth", tags: ["career", "work"], date: "2025-11-25", text: "Reflecting on my career trajectory. It's not just about climbing the ladder, it's about building skills." },
            { id: 5, title: "Mental Health Check", tags: ["mental-health", "personal"], date: "2025-11-24", text: "Taking time to check in with myself. Therapy has been incredibly valuable." },
            { id: 6, title: "Ironman Training", tags: ["fitness", "ironman"], date: "2025-11-23", text: "Week 3 of Ironman training. The volume is intense but I'm adapting." },
            { id: 7, title: "Startup Pivot", tags: ["startups", "work", "ideas"], date: "2025-11-22", text: "Sometimes the best ideas come from listening to what customers actually need, not what we think they need." },
            { id: 8, title: "Deep Work", tags: ["thinking", "work"], date: "2025-11-21", text: "Read Cal Newport's Deep Work. Changed how I think about focus and productivity." },
            { id: 9, title: "TIL: React Hooks", tags: ["til", "work"], date: "2025-11-20", text: "Finally understood useEffect dependencies. It's about synchronization, not lifecycle." },
            { id: 10, title: "Gratitude", tags: ["personal", "mental-health"], date: "2025-11-19", text: "Three things I'm grateful for: health, meaningful work, and supportive friends." }
        ];

        // ============================================
        // SMART CONNECTION LOGIC
        // ============================================
        
        function createSmartLinks(notes) {
            const potentialLinks = [];
            
            // Calculate all potential connections with strength
            for (let i = 0; i < notes.length; i++) {
                for (let j = i + 1; j < notes.length; j++) {
                    const commonTags = notes[i].tags.filter(tag => notes[j].tags.includes(tag));
                    const strength = commonTags.length;
                    
                    if (strength >= MIN_CONNECTION_STRENGTH) {
                        potentialLinks.push({
                            source: notes[i].id,
                            target: notes[j].id,
                            strength: strength,
                            i: i,
                            j: j
                        });
                    }
                }
            }
            
            // Sort by strength (strongest connections first)
            potentialLinks.sort((a, b) => b.strength - a.strength);
            
            // Keep track of connections per node
            const connectionsCount = {};
            notes.forEach(note => connectionsCount[note.id] = 0);
            
            // Select best connections (avoid overcrowding)
            const selectedLinks = [];
            for (const link of potentialLinks) {
                if (connectionsCount[link.source] < MAX_CONNECTIONS_PER_NODE &&
                    connectionsCount[link.target] < MAX_CONNECTIONS_PER_NODE) {
                    selectedLinks.push(link);
                    connectionsCount[link.source]++;
                    connectionsCount[link.target]++;
                }
            }
            
            return selectedLinks;
        }

        const links = createSmartLinks(notes);

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        
        function getNodeColor(tags) {
            return tagColors[tags[0]] || "#64748b";
        }

        function getNodeSize(note) {
            // Larger nodes for notes with more connections
            const connections = links.filter(l => 
                l.source.id === note.id || l.target.id === note.id
            ).length;
            return 15 + Math.min(connections * 2, 15);
        }

        // ============================================
        // GRAPH SETUP
        // ============================================
        
        const container = document.getElementById('graph-container');
        const width = container.clientWidth;
        const height = container.clientHeight;

        const svg = d3.select("#graph")
            .attr("viewBox", [0, 0, width, height]);

        const g = svg.append("g");

        // Zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // Force simulation with adjusted parameters for cleaner layout
        const simulation = d3.forceSimulation(notes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(120).strength(d => d.strength * 0.2))
            .force("charge", d3.forceManyBody().strength(-400))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(50));

        // Create links
        const link = g.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("class", d => d.strength > 1 ? "link strong" : "link");

        // Create nodes
        const node = g.append("g")
            .selectAll("g")
            .data(notes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended))
            .on("click", (event, d) => openModal(d))
            .on("mouseenter", (event, d) => highlightConnections(d))
            .on("mouseleave", () => unhighlightConnections());

        node.append("circle")
            .attr("r", d => getNodeSize(d))
            .attr("fill", d => getNodeColor(d.tags));

        node.append("text")
            .attr("dy", d => getNodeSize(d) + 14)
            .text(d => d.tags[0]);

        // Update positions on tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // ============================================
        // INTERACTION FUNCTIONS
        // ============================================
        
        function highlightConnections(note) {
            link.classed("highlighted", d => 
                d.source.id === note.id || d.target.id === note.id
            );
        }

        function unhighlightConnections() {
            link.classed("highlighted", false);
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        
        function openModal(note) {
            document.getElementById('modalTitle').textContent = note.title;
            document.getElementById('modalDate').textContent = note.date;
            document.getElementById('modalText').textContent = note.text;

            const tagsContainer = document.getElementById('modalTags');
            tagsContainer.innerHTML = '';
            note.tags.forEach(tag => {
                const tagEl = document.createElement('span');
                tagEl.className = 'tag';
                tagEl.textContent = tag;
                tagEl.style.backgroundColor = tagColors[tag] || '#64748b';
                tagsContainer.appendChild(tagEl);
            });

            document.getElementById('noteModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('noteModal').style.display = 'none';
        }

        function resetZoom() {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
            );
        }

        // ============================================
        // FILTER FUNCTIONALITY
        // ============================================
        
        let activeFilters = new Set();

        function toggleFilters() {
            const panel = document.getElementById('filter-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            
            if (panel.style.display === 'block' && document.getElementById('filterTags').children.length === 0) {
                initializeFilters();
            }
        }

        function initializeFilters() {
            const allTags = new Set();
            notes.forEach(note => note.tags.forEach(tag => allTags.add(tag)));
            
            const filterContainer = document.getElementById('filterTags');
            allTags.forEach(tag => {
                const btn = document.createElement('button');
                btn.className = 'filter-tag';
                btn.textContent = tag;
                btn.onclick = () => toggleFilter(tag, btn);
                filterContainer.appendChild(btn);
            });
        }

        function toggleFilter(tag, btn) {
            if (activeFilters.has(tag)) {
                activeFilters.delete(tag);
                btn.classList.remove('active');
            } else {
                activeFilters.add(tag);
                btn.classList.add('active');
            }
            
            applyFilters();
        }

        function applyFilters() {
            if (activeFilters.size === 0) {
                // Show all nodes
                node.style("opacity", 1);
                link.style("opacity", 0.4);
            } else {
                // Filter nodes
                node.style("opacity", d => 
                    d.tags.some(tag => activeFilters.has(tag)) ? 1 : 0.1
                );
                
                // Filter links
                link.style("opacity", d => {
                    const sourceMatch = d.source.tags.some(tag => activeFilters.has(tag));
                    const targetMatch = d.target.tags.some(tag => activeFilters.has(tag));
                    return (sourceMatch && targetMatch) ? 0.4 : 0.05;
                });
            }
        }

        // Close modal on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('noteModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // ============================================
        // LOAD FROM JSON (uncomment when ready)
        // ============================================
        /*
        async function loadNotes() {
            try {
                const response = await fetch('/notes/notes.json');
                const data = await response.json();
                // Reinitialize graph with new data
                initializeGraph(data.notes);
            } catch (error) {
                console.error('Error loading notes:', error);
            }
        }
        
        loadNotes();
        */
    </script>
</body>
</html>
